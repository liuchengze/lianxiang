!function(){function e(){this.terminal=1,this.shareCode="",this.nowNumber=31536e8,this.baseInfo={name:"",showPrice:0,price:0,marketable:0,mallType:n.mallTypeMapping.lenovoShop.code,materialNumber:"",isService:0,salesType:0,stock:0,isIndependentSale:0,isPhysical:0,LCode:"",gmsl:5},this.activity=null,this.promotion={gifts:null,giftsSelectable:null,saleReduction:null,fullReduction:null,goodsStatus:null,option:null,packs:null},this.components={scrollPicture:null,title:null,guige:null,service:null,buygroup:null,srdz:null,bxzp:null,tjxj:null,hotlist:null}}function t(){return Boolean("object"==typeof global&&global&&global.Object===Object&&global)}function o(e,t,o){for(var i=[],s=0;s<e.length;s++)t(e[s])==o&&i.push(e[s]);return i}function i(e,t){return RegExp(e).test(t)}function s(e){for(var t=new Array,o=0;o<e.length;o++)i(e[o],t)||t.push(e[o]);return t}e.prototype={constructor:e,private_process_activity:function(){var e=this;if(void 0!==e.activity&&("undefined"==typeof iskcode||0==iskcode)){var t=e.activity,o=this.nowNumber;switch(e.baseInfo.activityType){case 1:var i=e.activity.PurchasedJson={};i.fromtime=t.buyStartTime,i.totime=t.buyEndTime,i.fromtimeStr=t.buyStartTimeStr,i.totimeStr=t.buyEndTimeStr,i.productPrice=e.baseInfo.price,i.discount=t.discount,i.purchaseCeiling=t.purchaseCeiling,e.baseInfo.gmsl=t.purchaseCeiling;break;case 2:var s=e.activity.ShanGou={};s.startNumber=t.buyStartTime,s.startTimeStr=t.buyStartTimeStr,s.endNumber=t.buyEndTime,s.endTimeStr=t.buyEndTimeStr,s.yystartNumber=t.reservationStartTime,s.yystartTimeStr=t.reservationStartTimeStr,s.yyendNumber=t.reservationEndTime,s.yyendTimeStr=t.reservationEndTimeStr,s.fyyStartNumber=t.noReservationBuyTime,s.fyyStartTimeStr=t.noReservationBuyTimeStr,s.purchaseCeiling=t.purchaseCeiling,s.discount=t.discount,o<s.endNumber&&(e.baseInfo.gmsl=t.purchaseCeiling,e.baseInfo.showPrice=parseFloat(e.baseInfo.price)-parseFloat(s.discount)),0==e.activity.isReservation?s.type=0:1==e.activity.isReservation&&void 0==e.activity.noReservationBuyTime?s.type=1:1==e.activity.isReservation&&e.activity.noReservationBuyTime&&(s.type=2);break;case 3:var n=e.activity.flushSaleJson={};n.fromtime=t.buyStartTime,n.totime=t.buyEndTime,n.fromtimeStr=t.buyStartTimeStr,n.totimeStr=t.buyEndTimeStr,n.productPrice=e.baseInfo.price,n.discountAmount=t.discount,n.purchaseCeiling=t.purchaseCeiling,e.baseInfo.showPrice=parseFloat(e.baseInfo.price)-parseFloat(n.discountAmount),o>n.fromtime&&o<n.totime?(n.status="IN",e.baseInfo.gmsl=t.purchaseCeiling):o<t.flushSaleJson.fromtime?(n.status="BEFORE",e.baseInfo.gmsl=t.purchaseCeiling):(n.status="AFTER",e.baseInfo.showPrice=e.baseInfo.price)}}},processBuyButton:function(){var e={isShow:!0,showText:"立即购买",isDisabled:!0};if(0==this.baseInfo.marketable)e.showText="商品已下架";else if(0==this.baseInfo.isIndependentSale)e.showText="非独立销售商品";else if(0==this.isCurrentTerminal())e.showText="不在当前平台销售";else if(this.isLcodeProduct())e.showText="L 码购买",e.isDisabled=!1;else if(5==this.baseInfo.salesType)e.showText="立即定制",e.isDisabled=!1;else if(2==this.baseInfo.salesType)e.showText="敬请期待",e.isDisabled=!0;else if(3==this.baseInfo.activityType){var t=this.activity;"BEFORE"==t.flushSaleJson.status?(e.showText="抢购未开始",e.isDisabled=!0):(t.flushSaleJson.status,this.baseInfo.stock>0?(e.showText="立即购买",e.isDisabled=!1):(e.showText="已售罄",e.isDisabled=!0))}else this.baseInfo.stock<=0?e.showText="已售罄":(e.showText="立即购买",e.isDisabled=!1);return e},processAddCartButton:function(){var e={isShow:!0,showText:"加入购物车",isDisabled:!1},t=this.nowNumber;if(/^(2|4|5|6|98)$/gi.test(this.baseInfo.salesType+""))e.isShow=!1;else if(window.ischangenew&&1==window.ischangenew)e.isShow=!1;else if(0==this.baseInfo.stock)e.isShow=!1;else if(0==this.baseInfo.marketable)e.isShow=!1;else if(0==this.baseInfo.isPhysical&&30==this.baseInfo.buOwner)e.isShow=!1;else if(0==this.baseInfo.isIndependentSale)e.isShow=!1;else if(0==this.isCurrentTerminal())e.isShow=!1;else if(this.shareCode&&this.shareCode.length>0)e.isShow=!1;else if(this.isLcodeProduct())e.isShow=!1;else if(this.baseInfo.isService>0&&0==this.baseInfo.isPhysical)e.isShow=!1;else if(3==this.baseInfo.activityType){var o=this.activity.flushSaleJson.totime;e.isShow=t>o}else if(2==this.baseInfo.activityType){var i=this.activity.ShanGou;i.endNumber&&this.nowNumber<i.endNumber&&(e.isShow=!1)}else 1==this.baseInfo.activityType&&t<this.activity.PurchasedJson.totime?e.isShow=!1:e.isShow=!0;return e},processNoticeButton:function(){var e={isShow:!1,showText:"到货通知",isDisabled:!1};return this.baseInfo.stock<=0&&0!=this.baseInfo.isPhysical&&!this.isShowYuyue()&&(e.isShow=!0),e},processShowPrice:function(){var e={isShow:!0,showText:"",isDisabled:!1};return this.isShowYuyue()?e.showText="按需定制":0==this.baseInfo.isShowPrice&&this.baseInfo.mallType==n.mallTypeMapping.lenovoShop.code?e.showText="暂无报价":this.baseInfo.showPrice>0?e.showText=this.baseInfo.showPrice.toFixed(2):e.showText="",e},processBXZPNeedShowList:function(){var e=[],t=this.promotion.gifts;if(t&&0!=t.length)for(var o=this.nowNumber,i=0;i<t.length;i++){var s=t[i],n=this.promotion&&this.promotion.goodsStatus&&this.promotion.goodsStatus[s.code],a=o>s.fromtime&&o<s.totime;n&&a&&e.push(s)}else e=[];return e},processKXZPNeedShowList:function(){var e=[],t=this.promotion.giftsSelectable;if(t&&0!=t.length)for(var o=this.nowNumber,i=0;i<t.length;i++){var s=t[i],n=this.promotion&&this.promotion.goodsStatus&&this.promotion.goodsStatus[s.code],a=o>s.fromtime&&o<s.totime;n&&a&&e.push(s)}else e=[];return e},processXJNeedShowList:function(){var e=[];if(this.promotion&&this.promotion.option&&0!=this.promotion.option.length)for(var t=this.nowNumber,o=0;o<this.promotion.option.length;o++){var i=this.promotion.option[o],s=this.promotion&&this.promotion.goodsStatus&&this.promotion.goodsStatus[i.code],n=t>i.fromtime&&t<i.totime,a=parseFloat(i.discountAmount);s&&n&&e.push($.extend({showPrice:i.productPrice-a},i))}else e=[];return e},fn_Specifications:{SpecificationsRelList:{},SpecificationsRels:"",valeDisabled:function(e,t){var o=this;if(o.SpecificationsRelList){if(0==o.SpecificationsRelList.length)return[];for(var n="string"==typeof e||"number"==typeof e?this.getDefaultSF(e):e,a=[],r=[],c=0;c<n.length;c++){for(var l=[],u=0,p=0;p<specInfo.length;p++)if(specInfo[p].typeid==n[c].typeid){u=p;break}for(var f=0;f<specInfo[c].gsdlist.length;f++)n[c].gsdId==specInfo[u].gsdlist[f].gsdId&&l.push(specInfo[c].gsdlist[f].gcode);l.length>0&&r.push(l)}var d=[];if(r.length>0&&$.each(r[0],function(e,t){for(var o=1,i=1;i<r.length;i++)$.inArray(t,r[i])!=-1&&o++;o==i&&d.push(t)}),d.length>0)var h=d;else var h=[code];return $.each(n,function(e,t){$.each(o.SpecificationsRels,function(e,o){if(t.typeid!=o.typeid){var n=[],r=[];$.each(o.gsdlist,function(e,t){h instanceof Array&&h.length>0&&(h.join("").indexOf(t.gcode)==-1?n.push(t.gsdId):r.push(t.gsdId))}),$.each(s(n),function(e,t){i(t,r)||a.push(t)})}})}),$.each(a,function(e,o){if("function"==typeof t)return t(o)}),a}},valeDefault:function(e,t){if(this.SpecificationsRelList){var o=[];return $.each(this.getDefaultSF(e),function(e,i){o.push(i.gsdId),"function"==typeof t&&t(i.gsdId)}),o}},getgcode:function(e){var t=this;if(e){var o=[];if($.each(e,function(e,i){o=0==o.length?t.getcodesbygg(i.typeid,i.gsdId):t.intersect(o,t.getcodesbygg(i.typeid,i.gsdId))}),1==o.length)return o[0]}if(0==t.SpecificationsRelList.length)return[];var i=[];return $.each(t.SpecificationsRels,function(e,t){$.each(t.gsdlist,function(e,t){i.push(t.gcode)})}),0==i.length?[]:s(i)},getDefaultSF:function(e){var t=[];return $.each(this.SpecificationsRels,function(o,i){$.each(i.gsdlist,function(o,s){s.gcode==e&&t.push({typeid:i.typeid,gsdId:s.gsdId})})}),t},getcodesbygg:function(e,t){var o=this,i=[];return $.each(o.SpecificationsRels,function(o,s){s.typeid==e&&$.each(s.gsdlist,function(e,o){o.gsdId==t&&i.push(o.gcode)})}),i},intersect:function(e,t){var o=[];return $.each(s(e),function(e,s){return i(s,t)?o.push(s):null}),o}},getShareInfo:function(){var e=!1,t=window.location.href,o=n.queryString("sharecode");if(o&&o.length>0){e=!0,this.shareCode=o,n.addCookie("sharecode",this.shareCode,{expires:15});var i=n.queryString("promotionChannels")||"",s=this.shareCode,a="test"==env?".lenovouat.cn":".lenovo.com.cn";n.addCookie("c2clenovo",'{"promotionName":"'+$p.baseInfo.name+'","promotionType":"0","promotionChannels":"'+i+'","memberId":"'+s+'", "type": "1"}',{domain:a,expires:15}),n.addCookie("wi","",{domain:a,expires:-1}),n.addCookie("cid","",{domain:a,expires:-1}),n.addCookie("target","",{domain:a,expires:-1}),n.addCookie("channel","",{domain:a,expires:-1}),n.addCookie("source","",{domain:a,expires:-1}),$.get("/api/c2c/sharedby.do",{sharecode:this.shareCode,sourceurl:t,promotionChannels:i,promotionName:this.baseInfo.name,promotionType:"0"})}return e},isShowYuyue:function(){return this.mallType==n.mallTypeMapping.SMBShop.code&&"0"==this.baseInfo.isShowPrice},isShowActivity:function(){var e=this.baseInfo;return 0!=e.marketable&&0!=e.isIndependentSale&&this.isCurrentTerminal()&&2!=e.salesType},isShowShangou:function(){return 2==this.baseInfo.activityType&&this.isShowActivity()},isCurrentTerminal:function(){return 1==this.terminal?1==this.baseInfo.isPcSales:2==this.terminal?1==this.baseInfo.isWapSales:3==this.terminal?1==this.baseInfo.isAppSales:1==this.baseInfo.isWeiXinSales},isLcodeProduct:function(){return!(!window.iskcode||1!==iskcode)},loadData:function(e){var t=this;t.loadProductInfo(function(){t.loadPromotionInfo(function(){t.loadStock(function(){e&&e.call(t)})})})},loadProductInfo:function(e,t,o){var i=this;$.ajax({type:"GET",url:"/cache/detail?code="+code+"&ss="+(new Date).getMilliseconds(),dataType:"json",error:function(){i.baseInfo.price=i.baseInfo.showPrice=0,t&&"function"==typeof t&&t()},complete:function(){o&&"function"==typeof o&&o()},success:function(t){var o=t.data&&t.data[0]&&t.data[0].detail;"200"==t.status&&(o&&(o.mallType&&(i.baseInfo.mallType=o.mallType,i.baseInfo.shopid=o.mallType,i.baseInfo.isService=o.isService,i.baseInfo.shopid==n.mallTypeMapping.SMBShop.code&&(i.baseInfo.gmsl=999),"0"==plat&&setCarUrl(i.mallType)),i.baseInfo.isPhysical=o.isPhysical||0,i.baseInfo.buOwner=o.buOwner||0,i.baseInfo.isPcSales=o.isPcSales||0,i.baseInfo.isWapSales=o.isWapSales||0,i.baseInfo.isAppSales=o.isAppSales||0,i.baseInfo.isWeiXinSales=o.isWeiXinSales||0,i.baseInfo.isIndependentSale=o.isIndependentSale||0,i.baseInfo.name=o.name||"",i.baseInfo.isShowPrice=o.isShowPrice||0,i.baseInfo.salesType=o.salesType||0,i.baseInfo.pcPromotion=o.pcPromotion||null,i.baseInfo.materialNumber=o.materialNumber||"",i.baseInfo.productId=o.productId||"",i.baseInfo.extensionTerminal=o.extensionTerminal||"",i.baseInfo.extensionContent=o.extensionContent||""),i.curDatetime=t.curDatetime,i.nowNumber=new Date(i.curDatetime.replace(/-/g,"/"))-0,t.data[0].activity&&t.data[0].activity.activityType?(i.activity=t.data[0].activity,i.baseInfo.activityType=t.data[0].activity.activityType):(i.activity=null,i.baseInfo.activityType=0),1==i.terminal&&t.data[0].pc?i.baseInfo.price=i.baseInfo.showPrice=t.data[0].pc:2==i.terminal&&t.data[0].wap?i.baseInfo.price=i.baseInfo.showPrice=t.data[0].wap:3==i.terminal&&t.data[0].app?i.baseInfo.price=i.baseInfo.showPrice=t.data[0].app:4==i.terminal&&t.data[0].weixin?i.baseInfo.price=i.baseInfo.showPrice=t.data[0].weixin:i.baseInfo.price=0,i.baseInfo.marketable=t.data[0].marketable||0,"3"==i.baseInfo.isService&&(i.baseInfo.gmsl=1)),i.private_process_activity(),e&&"function"==typeof e&&e()}})},loadStock:function(e){var t=this,o=new Date(t.curDatetime.replace(/-/g,"/").replace(/-/g,"/")).valueOf(),i="";i=t.baseInfo.activityType>0&&o<t.activity.buyEndTime?"[{activityType:"+t.baseInfo.activityType+", productCode:"+code+"}]":"[{activityType:0, productCode:"+code+"}]","98"==t.baseInfo.salesType?t.loadO2OCityListAndStock(e):$.ajax({type:"POST",url:"/stock/getStockInfo.jhtm?ss="+(new Date).getMilliseconds(),data:{proInfos:i},complete:function(){e&&"function"==typeof e&&e()},success:function(e){t.baseInfo.stock=parseInt(e&&e[0]&&e[0].salesNumber||0)},error:function(e){n.warn("the ajax is fail"+e.responseText+"--"+e.statusText)}})},loadO2OCityListAndStock:function(e){var t=this,o=function(e){for(var o=[],i=!1,s=0;s<e.length;s++){i=!1;var n=e[s];n.salesNumber>0?(n.className="normal",t.baseInfo.thinko2oStock+=parseInt(n.salesNumber)):n.className="gray";for(var a=0;a<o.length;a++)if(n.provinceNo==o[a].provinceNo){o[a].cities.push(n),i=!0;break}i||o.push({provinceNo:n.provinceNo,provinceName:n.provinceName,cities:[n]})}return t.baseInfo.stock=t.baseInfo.thinko2oStock,o};(function(e){return $.ajax({type:"GET",url:"/cache/thinko2ocities",data:$.extend({code:code,activityType:t.baseInfo.activityType,saleType:t.baseInfo.salesType},e||{}),dataType:"json"})})().done(function(e){"200"==e.status&&e.data&&e.data.length>0&&o(e.data)}).always(function(){e()})},loadPromotionInfo:function(e,t,o){var i=this;$.ajax({type:"GET",data:{code:code,platformCode:i.terminal,salesPlat:i.terminal},url:"/api/promotions?"+(new Date).getMilliseconds(),dataType:"json",complete:function(){o&&"function"==typeof o&&o()},error:function(){i.promotion={},t&&"function"==typeof t&&t()},success:function(t){if(t&&"200"==t.status){if(t.data){var o=t.data;$.extend(i.promotion,o)}e&&"function"==typeof e&&e()}}})},jsonpIsTuangouUser:function(e,t){$.ajax({type:"GET",url:config_grq[env][plat].gwc+"tuanstatus.jhtml?ss="+(new Date).getMilliseconds(),data:{gcode:code,activityId:this.baseInfo.activityType},dataType:"jsonp",jsonp:"callbackparam",success:e,error:t||function(e){n.warn("the ajax -> tuanstatus is fail"+e.responseText+"--"+e.statusText)}})},jsonpIsBookUser:function(e,t){$.ajax({type:"GET",url:config_grq[env][plat].gwc+"bookStatus.jhtml",data:{plat:this.terminal,activityId:this.activity.activityId,gcode:code},dataType:"jsonp",jsonp:"callbackparam",success:e,error:function(){n.error("获取预约资格失败！"),t&&"function"==typeof t&&t()}})},jsonpShangouYuyue:function(e,t){var o=this;$.ajax({type:"GET",url:config_grq[env][plat].gwc+"addReservation.jhtml",data:{plat:$p.terminal,gcode:code},dataType:"jsonp",jsonp:"callbackparam",success:e,error:function(){o.debug&&n.warn("发送预约信息失败！"),t&&"function"==typeof t&&t()}})},jsonpAddItemToCart:function(e,t,o){$.ajax({type:"GET",url:config_grq[env][plat].gwc+"additemtocart.jhtml?ss="+(new Date).getMilliseconds(),data:e,dataType:"jsonp",jsonp:"callbackparam",success:t,error:o||function(){n.warn("additemtocart the ajax is fail")}})},jsonpNoticeSendSms:function(e,t,o){$.ajax({type:"GET",url:"/stock/sendsms.jhtm",data:e,dataType:"jsonp",jsonp:"jsonpcallback",success:t,error:o||function(){n.warn("到货通知-> 发送短信失败"),alert("系统繁忙，请稍后再试")}})},jsonpNoticeSave:function(e,t,o){$.ajax({type:"POST",url:e.url||"/stock/subscribe.jhtm",data:e,dataType:"jsonp",jsonp:"jsonpcallback",success:t,error:o})},loadServiceInfo:function(e,t,o){$.ajax({url:e.url||"/cache/servicelist",data:{code:code,terminal:this.terminal},dataType:"json",success:t,error:o||function(){n.warn("请求服务信息失败！")}})},loadHostList:function(e,t,o){$.ajax({type:"GET",url:e.url||"/api/products/gethotlist.jhtm?ss="+(new Date).getMilliseconds(),data:{w:205,h:205,salesPlat:this.terminal},dataType:"json",success:t,error:o||function(){window.PDUtil.warn("hotlist ajax error")}})},loadMyFavorite:function(e,t,o){$.ajax({type:"GET",url:"/api/myfavorites/"+e.url+(new Date).getMilliseconds(),data:{gcode:code,plat:this.terminal},dataType:"json",success:t,error:o})},loadPresellInfo:function(e,t,o){var i={shopId:$p.baseInfo.mallType,gcode:code,terminal:$p.terminal};e=$.extend(i,e||{}),$.ajax({type:"GET",url:config_grq[env][plat].presell,data:e,dataType:"jsonp",jsonp:"callbackparam",success:t,error:o||function(){alert("获取预售信息失败, 请稍后再试")}})},jsonpSaveBookShangouTel:function(e,t,o){$.ajax({type:"GET",url:config_grq[env][plat].gwc+"updateBookPhone.jhtml?ss="+(new Date).getMilliseconds()+"&plat="+this.terminal,data:e,dataType:"jsonp",jsonp:"callbackparam",success:t,error:function(){n.warn("保存预约闪购手机号时出现错误！"),o&&"function"==typeof o&&o()}})},debug:!0};var n={isRunInNode:t,mallTypeMapping:{lenovoShop:{code:"1",name:"联想商城"},thinkShop:{code:"2",name:"think商城"},SMBShop:{code:"8",name:"SMB商城"},SMBScoreShop:{code:"9",name:"SMB积分商城"}},queryString:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),o=window.location.search.substr(1).match(t);return null!=o?decodeURIComponent(o[2]):null},addCookie:function(e,t,o){if(o=$.extend({path:"/"},o||{}),"number"==typeof o.expires){var i=o.expires,s=o.expires=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*i)}return document.cookie=[encodeURIComponent(e),"=",window.PDUtil.stringifyCookieValue(t,o),o.expires?"; expires="+o.expires.toUTCString():"",o.path?"; path="+o.path:"",o.domain?"; domain="+o.domain:"",o.secure?"; secure":""].join("")},stringifyCookieValue:function(e,t){return encodeURIComponent(t.json?JSON.stringify(e):String(e))},getCookie:function(e){for(var t=document.cookie,o=t.split("; "),i=0;i<o.length;i++){var s=o[i].split("=");if(s[0]==e)return decodeURIComponent(s[1])}return null},extend:function(e){var t=function(){e.call(this)};return Object.setPrototypeOf?Object.setPrototypeOf(t.prototype,e.prototype):t.prototype.__proto__?t.prototype.__proto__=e.prototype:(t.prototype=new e,t.prototype.constructor=t),t},dropSome:function(e,t){return o(e,t,!1)},getSome:function(e,t){return o(e,t,!0)},findFirst:function(e,t){for(var o=null,i=0;i<e.length;i++)if(1==t(e[i])){o=e[i];break}return o},cutPicturePath:function(e,t){if(e&&e.length>0&&t&&t>0){var o=e.lastIndexOf("."),i=e.substring(o,e.length);return e.substring(0,o)+".w"+t+i}return""},log:function(e){console&&console.log(e)},warn:function(e){console&&console.warn(e)},timer:function(e,t,o){e/=1e3;var i=setInterval(function(){var s=0,n=0,a=0,r=0;if(!(e>0))return clearInterval(i),o(),!1;s=Math.floor(e/86400),n=Math.floor(e/3600)-24*s,a=Math.floor(e/60)-24*s*60-60*n,r=Math.floor(e)-24*s*60*60-60*n*60-60*a,a<=9&&(a="0"+a),r<=9&&(r="0"+r);var c="";0!=s&&(c+=s+"天 "),c+=n+":"+a+":"+r,t(c,n,a,r),e--},1e3)},checkTelNo:function(e){return!!e&&/^1(3|4|5|7|8)[0-9]{9}$/g.test(e)}};1==n.isRunInNode()&&module&&module.exports?module.exports={PDUtil:n,PDBase:e}:(window.PDUtil=n,window.PDBase=e)}();